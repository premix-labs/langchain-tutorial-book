---
title: "‡∏ö‡∏ó‡∏ó‡∏µ‡πà 6: Memory ‚Äî ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥"
description: "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏£‡∏∞‡∏ö‡∏ö Memory ‡πÉ‡∏ô LangChain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Chatbot ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ"
sidebar:
  order: 6
---

import {
  Aside,
  Tabs,
  TabItem,
  Card,
  CardGrid,
} from "@astrojs/starlight/components";

## ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Memory?

LLMs **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á Memory ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ AI "‡∏à‡∏≥" ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ

```
‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Memory:
User: ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ä‡∏≤‡∏¢
AI: ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢!
User: ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
AI: ‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì  ‚Üê ‡∏•‡∏∑‡∏°‡πÅ‡∏•‡πâ‡∏ß!

‚úÖ ‡∏°‡∏µ Memory:
User: ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ä‡∏≤‡∏¢
AI: ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢!
User: ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
AI: ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏ä‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‚Üê ‡∏à‡∏≥‡πÑ‡∏î‡πâ!
```

---

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Memory ‡πÉ‡∏ô LangChain v1.0+

‡πÉ‡∏ô LangChain ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ memory ‡∏ó‡∏≥‡∏ú‡πà‡∏≤‡∏ô **message history** ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡πÄ‡∏Å‡πá‡∏ö messages ‡πÑ‡∏ß‡πâ‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô prompt

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‚Äî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Messages ‡πÄ‡∏≠‡∏á

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_core.messages import HumanMessage, AIMessage

llm = ChatOpenAI(model="gpt-4o-mini")

# Prompt ‡∏ó‡∏µ‡πà‡∏°‡∏µ placeholder ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö chat history
prompt = ChatPromptTemplate.from_messages([
    ("system", "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£ ‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"),
    MessagesPlaceholder(variable_name="chat_history"),
    ("human", "{input}"),
])

chain = prompt | llm

# ‡πÄ‡∏Å‡πá‡∏ö chat history ‡πÄ‡∏≠‡∏á
chat_history = []

def chat(user_message: str) -> str:
    # ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å LLM ‡∏û‡∏£‡πâ‡∏≠‡∏° history
    response = chain.invoke({
        "chat_history": chat_history,
        "input": user_message,
    })

    # ‡πÄ‡∏Å‡πá‡∏ö messages ‡∏•‡∏á history
    chat_history.append(HumanMessage(content=user_message))
    chat_history.append(AIMessage(content=response.content))

    return response.content

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
print(chat("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏±‡∏¢"))
# ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏¥‡∏ä‡∏±‡∏¢! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö

print(chat("‡∏ú‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?"))
# ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! üòä
```

---

## RunnableWithMessageHistory

LangChain ‡∏°‡∏µ helper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ history ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

```python
from langchain_core.runnables.history import RunnableWithMessageHistory
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.chat_history import BaseChatMessageHistory

# ‡πÄ‡∏Å‡πá‡∏ö history ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° session
store = {}

def get_session_history(session_id: str) -> BaseChatMessageHistory:
    if session_id not in store:
        store[session_id] = ChatMessageHistory()
    return store[session_id]

# ‡∏™‡∏£‡πâ‡∏≤‡∏á chain ‡∏û‡∏£‡πâ‡∏≠‡∏° memory
prompt = ChatPromptTemplate.from_messages([
    ("system", "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£"),
    MessagesPlaceholder(variable_name="history"),
    ("human", "{input}"),
])

chain = prompt | llm

# Wrap ‡∏î‡πâ‡∏ß‡∏¢ RunnableWithMessageHistory
chain_with_history = RunnableWithMessageHistory(
    chain,
    get_session_history,
    input_messages_key="input",
    history_messages_key="history",
)

# ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚Äî ‡∏£‡∏∞‡∏ö‡∏∏ session_id
config = {"configurable": {"session_id": "user-123"}}

response = chain_with_history.invoke(
    {"input": "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏ô‡∏µ‡∏Ñ‡πà‡∏∞"},
    config=config,
)
print(response.content)

response = chain_with_history.invoke(
    {"input": "‡∏â‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏∞?"},
    config=config,
)
print(response.content)  # ‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏ô‡∏µ!
```

<Aside type="tip">
  ‡πÉ‡∏ä‡πâ `session_id` ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å conversation history
  ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô
</Aside>

---

## ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Memory ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á

### 1. ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Messages (Sliding Window)

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

```python
from langchain_core.messages import trim_messages
from langchain_core.runnables import RunnablePassthrough

# ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 10 messages ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
trimmer = trim_messages(
    max_tokens=1000,
    strategy="last",         # ‡πÄ‡∏Å‡πá‡∏ö messages ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    token_counter=llm,       # ‡πÉ‡∏ä‡πâ LLM ‡∏ô‡∏±‡∏ö tokens
    include_system=True,     # ‡πÄ‡∏Å‡πá‡∏ö system message ‡πÄ‡∏™‡∏°‡∏≠
    allow_partial=False,
)

prompt = ChatPromptTemplate.from_messages([
    ("system", "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£"),
    MessagesPlaceholder(variable_name="history"),
    ("human", "{input}"),
])

# ‡πÉ‡∏™‡πà trimmer ‡πÉ‡∏ô chain
chain = (
    RunnablePassthrough.assign(history=lambda x: trimmer.invoke(x["history"]))
    | prompt
    | llm
)
```

### 2. ‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ (Summary Memory)

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

```python
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import StrOutputParser

llm = ChatOpenAI(model="gpt-4o-mini")

# Chain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
summary_prompt = ChatPromptTemplate.from_template("""
‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÑ‡∏ß‡πâ:

‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤: {existing_summary}

‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà:
{new_messages}

‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡∏°‡πà:
""")

summary_chain = summary_prompt | llm | StrOutputParser()

class SummaryMemory:
    def __init__(self):
        self.summary = ""
        self.recent_messages = []
        self.max_recent = 6  # ‡πÄ‡∏Å‡πá‡∏ö 6 messages ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

    def add_message(self, role: str, content: str):
        self.recent_messages.append(f"{role}: {content}")

        # ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡∏∏‡∏õ
        if len(self.recent_messages) > self.max_recent:
            self._summarize()

    def _summarize(self):
        # ‡∏™‡∏£‡∏∏‡∏õ messages ‡πÄ‡∏Å‡πà‡∏≤
        messages_text = "\n".join(self.recent_messages[:-2])
        self.summary = summary_chain.invoke({
            "existing_summary": self.summary,
            "new_messages": messages_text,
        })
        # ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 2 messages ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        self.recent_messages = self.recent_messages[-2:]

    def get_context(self) -> str:
        context = ""
        if self.summary:
            context += f"‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤: {self.summary}\n\n"
        if self.recent_messages:
            context += "‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:\n" + "\n".join(self.recent_messages)
        return context
```

### 3. Persistent Memory (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Database)

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

```python
# ‡πÉ‡∏ä‡πâ Redis ‡πÄ‡∏õ‡πá‡∏ô backend
from langchain_community.chat_message_histories import RedisChatMessageHistory

def get_session_history(session_id: str):
    return RedisChatMessageHistory(
        session_id=session_id,
        url="redis://localhost:6379",
        ttl=3600,  # ‡πÄ‡∏Å‡πá‡∏ö 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    )

# ‡πÉ‡∏ä‡πâ SQLite ‡πÄ‡∏õ‡πá‡∏ô backend
from langchain_community.chat_message_histories import SQLChatMessageHistory

def get_session_history(session_id: str):
    return SQLChatMessageHistory(
        session_id=session_id,
        connection="sqlite:///chat_history.db",
    )
```

<Aside type="note">
  ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Production** ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ persistent storage ‡πÄ‡∏ä‡πà‡∏ô Redis, PostgreSQL, ‡∏´‡∏£‡∏∑‡∏≠
  MongoDB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ restart server
</Aside>

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡∏£‡πâ‡∏≤‡∏á Chatbot ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Python ‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_core.output_parsers import StrOutputParser
from langchain_core.runnables.history import RunnableWithMessageHistory
from langchain_community.chat_message_histories import ChatMessageHistory

# Setup
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0.7)
store = {}

def get_history(session_id: str):
    if session_id not in store:
        store[session_id] = ChatMessageHistory()
    return store[session_id]

# Prompt
prompt = ChatPromptTemplate.from_messages([
    ("system", """‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô TechBot ‚Äî ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ
    - ‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    - ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
    - ‡∏ñ‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°"""),
    MessagesPlaceholder(variable_name="history"),
    ("human", "{input}"),
])

# Chain
chain = prompt | llm | StrOutputParser()
chatbot = RunnableWithMessageHistory(
    chain, get_history,
    input_messages_key="input",
    history_messages_key="history",
)

# Interactive Chat Loop
def main():
    session_id = "demo-session"
    config = {"configurable": {"session_id": session_id}}

    print("ü§ñ TechBot ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£! (‡∏û‡∏¥‡∏°‡∏û‡πå 'quit' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å)\n")

    while True:
        user_input = input("‡∏Ñ‡∏∏‡∏ì: ")
        if user_input.lower() == "quit":
            print("üëã ‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!")
            break

        response = chatbot.invoke(
            {"input": user_input},
            config=config,
        )
        print(f"ü§ñ TechBot: {response}\n")

if __name__ == "__main__":
    main()
```

---

## ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Memory Strategies

| Strategy           | ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ               | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢           | ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö      |
| ------------------ | ------------------- | ----------------- | ------------- |
| **Full History**   | ‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î        | ‡πÉ‡∏ä‡πâ tokens ‡∏°‡∏≤‡∏Å    | ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏™‡∏±‡πâ‡∏ô   |
| **Sliding Window** | ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° tokens       | ‡∏•‡∏∑‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤     | ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ |
| **Summary**        | ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î tokens      | ‡πÄ‡∏™‡∏µ‡∏¢ detail       | ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏¢‡∏≤‡∏ß    |
| **Persistent**     | ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ restart | ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á database | Production    |

---

:::note[‡∏Å‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ üîç]
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Chatbot ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ **[‡∏ö‡∏ó‡∏ó‡∏µ‡πà 7: RAG](/03-advanced/01-rag/)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á!
:::
